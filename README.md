# Установка

# Зависимости

 - docker >= 18.06
 - docker-compose >= 1.22
 - python 2.7
 - [rsa ключ для доступа к шифрованным данным](./docs/gpg.md)
 - доступ к серверу с резервными копиями

## Локальное окружение

Не фиксируем права доступа
```bash
git config core.fileMode false
```

Делаем скрипты исполняемыми

```
sudo chmod +x ./etc/scripts/*
```

Запускаем сборку
```bash
./etc/scripts/init_local -r -f
```

При указании ключа `-r` происходит сброс БД с использованием резервной копии.

Требуется ввести пароль.

При указании ключа `-f` собирается статика.

При повторном выполнении скрипта данный ключ можно опустить

### Шифрованные данные
Для каждого окружения есть шифрованный файл в котором хранятся секретные данные.

local - `./etc/env/.env.local.gpg`

production - `./etc/env/.env.production.gpg`

Детали по работе с ними [тут](./docs/gpg.md) 

### Изображение
Т.к. резервная копия изображений весит достаточно много было решено для локального окруженмия
подтягивать изображения напрямую с сайта politsturm.com с помощью proxy_pass. 
Детальнее в `./etc/docker/services/nginx/conf.d/defualt.conf` 
и `./etc/docker/services/nginx/conf.d/blocks/static_proxy_pass.conf`
